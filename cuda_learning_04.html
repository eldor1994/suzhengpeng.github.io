<!DOCTYPE html>
<html>

<head>
	<!-- Meta -->
	<meta charset="UTF-8"/>
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
	<meta name="generator" content="Jekyll">

	<title>
        
            CUDAå¹¶è¡Œç¼–ç¨‹å­¦ä¹ ï¼ˆ4ï¼‰-- å†…å­˜å…±äº« Share Memory - Su'S Blog - SuZhengpeng.COM 
        </title>
  <meta name="description" content="åŸºäºCUDAçš„å¹¶è¡Œç¼–ç¨‹å­¦ä¹ ç¬”è®° ">

	<!-- CSS & fonts -->
	<link rel="stylesheet" href="/css/main.css">

	<!-- RSS -->
	<link href="/atom.xml" type="application/atom+xml" rel="alternate" title="ATOM Feed" />

  <!-- Favicon -->
  <link rel="shortcut icon" type="image/png" href="/img/favicon.png">
    <style type="text/css">

</style>
<!-- MathJax -->
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [['$', '$'],['\\(', '\\)']],
            displayMath: [['$$', '$$'],["\\[", "\\]"]],
			skipTags: ['script', 'noscript', 'style', 'textarea', 'pre','code','a'],
            processEscapes: true
        },
        TeX: {
            extensions: ["AMSmath.js", "AMSsymbols.js"],
            equationNumbers: { autoNumber: ["AMS"],
			useLabelIds: true
            },
            Macros: {hfill: "{}"}
        },
        "HTML-CSS": {
            linebreaks: {automatic: true},
            availableFonts: ["TeX"],
            scale: 110
        },
        SVG: {
            linebreaks: {automatic: true}
        }
    });
</script>
<script type="text/javascript"
   src="https://cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>

<!-- Highlight -->

<link rel="stylesheet" href="/styles/magula.css">
<script src="/js/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>

<!-- <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script> -->
<!-- <script>
  (adsbygoogle = window.adsbygoogle || []).push({
    google_ad_client: "ca-pub-6731920064609305",
    enable_page_level_ads: true
  });
</script> -->

<!-- <script charset="utf-8" src="http://map.qq.com/api/js?v=2.exp"></script>
<script>
var init = function() {
    var center = new qq.maps.LatLng(37.916527,106.397128);
	//å±±ä¸œçœ
	var tsingtao = new qq.maps.LatLng(36.065162,120.312567);
	var jinan = new qq.maps.LatLng(36.670966,116.990919);
	//é™•è¥¿çœ
	var xian = new qq.maps.LatLng(34.276936,108.962660);
	var qianxian = new qq.maps.LatLng(34.532015,108.260822);
	//æ²³å—çœ
	var xinan = new qq.maps.LatLng(34.718308,112.154574);
	var zhengzhou = new qq.maps.LatLng(34.745509,113.657212);
	//ä¸Šæµ·å¸‚
	var shanghai = new qq.maps.LatLng(31.250085,121.455917);
	//æ±Ÿè‹çœ
	var kunshan = new qq.maps.LatLng(31.366225,120.957520);
	var fengxian = new qq.maps.LatLng(34.701436,116.649528);
	
    var map = new qq.maps.Map(document.getElementById('container-map'),{
        center: center,
        zoom: 7
    });
	   //è·å–åŸå¸‚åˆ—è¡¨æ¥å£è®¾ç½®ä¸­å¿ƒç‚¹
    citylocation = new qq.maps.CityService({
        complete : function(result){
            map.setCenter(result.detail.latLng);
        }
    });
    //è°ƒç”¨searchLocalCity();æ–¹æ³•    æ ¹æ®ç”¨æˆ·IPæŸ¥è¯¢åŸå¸‚ä¿¡æ¯ã€‚
    citylocation.searchLocalCity();
	
		//æ·»åŠ åˆ°æç¤ºçª—
	var info = new qq.maps.InfoWindow({
        map: map
    });
    //é’å²›
    var marker = new qq.maps.Marker({
        position: tsingtao,
        map: map
    });
    //è·å–æ ‡è®°
    qq.maps.event.addListener(marker, 'click', function() {
        info.open(); 
        info.setContent('<small>ğŸ“ <a href="/tag/tsingtao.html">å±±ä¸œçœé’å²›å¸‚</a><br>                   </small>');
        info.setPosition(tsingtao); 
    });
	//æµå—
	    var marker = new qq.maps.Marker({
        position: jinan,
        map: map
    });
    //è·å–æ ‡è®°
    qq.maps.event.addListener(marker, 'click', function() {
        info.open(); 
        info.setContent('<small>ğŸ“ <a href="/tag/ji%27nan.html">å±±ä¸œçœæµå—å¸‚</a><br>                   </small>');
        info.setPosition(jinan); 
    });
	//xian
	    var marker = new qq.maps.Marker({
        position: xian,
        map: map
    });
    //è·å–æ ‡è®°
    qq.maps.event.addListener(marker, 'click', function() {
        info.open(); 
        info.setContent('<small>ğŸ“ <a href="/tag/xi%27an.html">é™•è¥¿çœè¥¿å®‰å¸‚</a><br>                   </small>');
        info.setPosition(xian); 
    });
	//xin-an
	    var marker = new qq.maps.Marker({
        position: xinan,
        map: map
    });
    //è·å–æ ‡è®°
    qq.maps.event.addListener(marker, 'click', function() {
        info.open(); 
        info.setContent('<small>ğŸ“ <a href="#">æ²³å—çœæ–°å®‰å¿</a></small>');
        info.setPosition(xinan); 
    });
	//shanghai
	    var marker = new qq.maps.Marker({
        position: shanghai,
        map: map
    });
    //è·å–æ ‡è®°
    qq.maps.event.addListener(marker, 'click', function() {
        info.open(); 
        info.setContent('<small>ğŸ“ <a href="#">ä¸Šæµ·å¸‚</a></small>');
        info.setPosition(shanghai); 
    });
	//kunshan
	    var marker = new qq.maps.Marker({
        position: kunshan,
        map: map
    });
    //è·å–æ ‡è®°
    qq.maps.event.addListener(marker, 'click', function() {
        info.open(); 
        info.setContent('<small>ğŸ“ <a href="#">æ±Ÿè‹çœæ˜†å±±å¸‚</a></small>');
        info.setPosition(kunshan); 
    });
	//fengxian
	    var marker = new qq.maps.Marker({
        position: fengxian,
        map: map
    });
    //è·å–æ ‡è®°
    qq.maps.event.addListener(marker, 'click', function() {
        info.open(); 
        info.setContent('<small>ğŸ“ <a href="#">æ±Ÿè‹çœä¸°å¿</a></small>');
        info.setPosition(fengxian); 
    });
		//éƒ‘å· zhengzhou
	    var marker = new qq.maps.Marker({
        position: zhengzhou,
        map: map
    });
    //è·å–æ ‡è®°
    qq.maps.event.addListener(marker, 'click', function() {
        info.open(); 
                info.setContent('<small>ğŸ“ <a href="/tag/zheng%27zhou.html">æ²³å—çœéƒ‘å·å¸‚</a><br>                   </small>');
        info.setPosition(zhengzhou); 
    });
	//ä¹¾å¿ Qianxian
	    var marker = new qq.maps.Marker({
        position: qianxian,
        map: map
    });
    //è·å–æ ‡è®°
    qq.maps.event.addListener(marker, 'click', function() {
        info.open(); 
                info.setContent('<small>ğŸ“ <a href="/tag/qian%27xian.html">é™•è¥¿çœä¹¾å¿</a><br>                   </small>');
        info.setPosition(qianxian); 
    });
	
	
}

</script>   -->

<script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML"></script>  

<script type="text/javascript" src="/js/jquery-1.8.3.min_2.js"></script>
<link href='http://fonts.googleapis.com/css?family=Tauri' rel='stylesheet' type='text/css'>
<style type="text/css">
	.shang_con{width:100px;margin:20px auto;}
	.shang_hide_box{z-index:999;filter:alpha(opacity=50);background:#666;opacity: 0.5;-moz-opacity: 0.5;left:0;top:0;height:99%;width:100%;position:fixed;display:none;}
	.shang_box{width:540px;height:540px;padding:10px;background-color:#fff;border-radius:10px;position:fixed;z-index:1000;left:50%;top:50%;margin-left:-280px;margin-top:-280px;border:1px dotted #dedede;display:none;}
	.shang_box img{border:none;border-width:0;}
	.dashang{display:block;width:100px;margin:5px auto;height:45px;line-height:25px;padding:10px;background-color:#E74851;color:#fff;text-align:center;text-decoration:none;border-radius:10px;font-weight:bold;font-size:16px;transition: all 0.3s;}
	.dashang:hover{opacity:0.8;padding:15px;font-size:18px;}
	.shang_close{display:inline-block;}
	.shang_logo{display:block;text-align:center;margin:20px auto;}
	.shang_tit{width: 100%;height: 75px;text-align: center;line-height: 66px;color: #a3a3a3;font-size: 16px;font-family: 'Microsoft YaHei';margin-top: 7px;margin-right:2px;}
	.shang_tit p{color:#a3a3a3;text-align:center;font-size:16px;}
	.shang_payimg{width:140px;margin:0 auto;border-radius:3px;height:140px;}
	.shang_payimg img{display:block;text-align:center;width:140px;height:140px; }
	.pay_explain{text-align:center;margin:10px auto;font-size:12px;color:#545454;}
	.radiobox{width: 16px;height: 16px;background: url('img/ds/radio2.jpg');display: block;float: left;margin-right: 14px; margin-left: 50px;margin-bottom: 10px;}
	.checked .radiobox{background:url('img/ds/radio1.jpg');}
	.shang_payselect{text-align:center;margin:0 auto;margin-top:40px;cursor:pointer;height:60px;width:280px;}
	.shang_payselect .pay_item{display:inline-block;margin-right:10px;}
	.shang_info{clear:both;}
	.shang_info p,.shang_info a{color:#C3C3C3;text-align:center;text-decoration:none;line-height:2em;}
</style>
		</head>


<body>
	<div id="wrap">
	  	
	  	<!-- Navigation -->
	  	

<nav id="nav">

    <!-- Nav links -->
	  

  
  <!-- Nav footer 
	
	  <footer><span>

<div class="footer" id="nav-links">

	<div class="footer-one">
	
		<div class="footer-ico"></div>
		<br>
		Suzhengpeng.COM
		<br>
			 <div class="footer-power">
		Proudly hosted by Github and powered by Jekyll <br> All designed by Suzhengpeng.COM </div>
		<br>
	
	</div>
	
	<div class="footer-two">
	
		

	    
		
			<a href="/pages/page/about" title="å…³äºåšä¸»">å…³äºåšä¸»</a>&nbsp;&nbsp;<br>
		

	    
		

	    
		
			<a href="/pages/page/contact" title="è”ç³»æ–¹å¼">è”ç³»æ–¹å¼</a>&nbsp;&nbsp;<br>
		

	    
		
			<a href="/pages/page/copyright" title="ç‰ˆæƒå£°æ˜">ç‰ˆæƒå£°æ˜</a>&nbsp;&nbsp;<br>
		

	    
		

	    
		

	    
		

	    
		

	    
		

	    
		

	    
		

	    
		

	    
		

	    
		

	    
		

	    
		

	    
		

	    
		

	    
		

	    
		

	    
		

	    
		

	    
		

	    
		

	    
		

	    
		

	    
		

	    
		

	    
		

	    
		

	    
		

	    
		<br>

	</div>
	<div class="footer-two">
					
				
				
				
				
				
				
				
				
				
				
				
				
				
			<a href="/pages/data/link" title="å¸¸ç”¨é“¾æ¥">å¸¸ç”¨é“¾æ¥</a>&nbsp;&nbsp;
		
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
		
	</div>
	<div class="footer-two-1">
	<b><small>å‹æƒ…é“¾æ¥</small></b>
					
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
			<br><a href="http://www.yushuai.me/" title="å°å¥¥ã®ä¸“å±é¢†åœ°" target="_blank">å°å¥¥ã®ä¸“å±é¢†åœ°</a>&nbsp;&nbsp;
		
				
				
			<br><a href="https://www.zning.net.cn/" title="å¼ å®ç½‘" target="_blank">å¼ å®ç½‘</a>&nbsp;&nbsp;
		
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
		
	</div>
	<div class="footer-three">
			<div class="footer-qrcode">
			<img src="http://tool.oschina.net/action/qrcode/generate?data=http://www.suzhengpeng.com/cuda_learning_04&output=image%2Fgif&error=L&type=0&margin=0&size=4">
			</div>
			<small>æ‰«ç åˆ†äº«</small><br>


	</div>


</div>
</span>



 </footer>
	-->
 <a href="/"><div class="footer-ico">
</div></a>
<br><br>
	<div id="nav-list">
		<!-- Nav pages -->

		
	    
		
			<a href="/pages/page/about" title="å…³äºåšä¸»">å…³äºåšä¸»</a>&nbsp;&nbsp;
		
	    
		
	    
		
			<a href="/pages/page/contact" title="è”ç³»æ–¹å¼">è”ç³»æ–¹å¼</a>&nbsp;&nbsp;
		
	    
		
			<a href="/pages/page/copyright" title="ç‰ˆæƒå£°æ˜">ç‰ˆæƒå£°æ˜</a>&nbsp;&nbsp;
		
	    
		
	    
		
	    
		
	    
		
	    
		
	    
		
	    
		
	    
		
	    
		
	    
		
	    
		
	    
		
	    
		
	    
		
	    
		
	    
		
	    
		
	    
		
	    
		
	    
		
	    
		
	    
		
	    
		
	    
		
	    
		
	    
		
	    
		
	    
		<br>

	 <br>Suzhengpeng @ Xidian University<br><br>
	 <div class="footer-power">
		Proudly hosted by Github and powered by Jekyll <br> All designed by Suzhengpeng.COM  <br><br>
</div>
    </div>


 <div class="footer-ico-con">
 <table><tr>
<td><a href="http://space.bilibili.com/15155880" target="_blank"><img src="/img/ico/bilibili.ico"/></a> </td>
<td><a href="https://github.com/suzhengpeng" target="_blank"><img src="/img/ico/github.ico"/></a> </td>
<td><a href="http://weibo.com/sdustem" target="_blank"><img src="/img/ico/weibo.ico"/></a> </td>
<td><a href="https://www.douban.com/people/imsus/" target="_blank"><img src="/img/ico/douban.ico"/></a> </td>
<td><script type="text/javascript">var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan id='cnzz_stat_icon_1261868763'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s4.cnzz.com/z_stat.php%3Fid%3D1261868763%26show%3Dpic1' type='text/javascript'%3E%3C/script%3E"));</script></td>
</tr></table>
</div> 


<small>
		
				
	  		
				
	  		
				
	  		
				
	  		
				
	  		
				
	  		
				
			<a href="/pages/data/link" title="å¸¸ç”¨é“¾æ¥">å¸¸ç”¨é“¾æ¥</a>&nbsp;&nbsp;
		
	  		
				
	  		
				
	  		
				
	  		
				
	  		
				
	  		
				
	  		
				
	  		
				
	  		
				
	  		
				
	  		
				
	  		
				
	  		
				
	  		
				
	  		
				
	  		
				
	  		
				
	  		
				
	  		
				
	  		
				
	  		
				
	  		
				
	  		
				
	  		
				
	  		
				
	  
	 <br> 
</small>
 
<br>
	</nav>
    
    <!-- Icon menu -->
	  <a id="nav-menu">
	  	<div id="menu"></div>
	  </a>

      <!-- Header -->
      
        <header id="header" class="parent justify-spaceBetween">
  <div class="inner w100 relative">
    <div class="f-logo">  
      <a href="/">
        <h1>
          <span>Su</span>'S Blog
        </h1>
      </a>
    </div>

  </div>
</header>




      

    <!-- Main content -->
	  <div id="container">
		  
		<main>

			<article id="post-page">
		Sep 27, 2018
	
	<h3>CUDAå¹¶è¡Œç¼–ç¨‹å­¦ä¹ ï¼ˆ4ï¼‰-- å†…å­˜å…±äº« Share Memory </h3>
	<!-- JiaThis Button BEGIN -->
	
<div style="padding: 10px; background:#fff;">

	<div style="position: relative; 
				border: 2px solid #E9F01D; 
				padding: 10px; 
				padding-bottom:20px;
				width:60%;
				min-width:300px;
				background:#E9F01D;
				color:#404040;
				border-radius:4px;
				" >
		<span style="position: absolute; 
					left: 30px; top: -32px; 
					width: 0; height: 0; 
					font-size: 0; 
					border-width: 16px; 
					border-style: dashed dashed solid dashed; 
					border-color: transparent transparent #E9F01D transparent;" ></span>
<div class="bshare-custom"><div class="bsPromo bsPromo2"></div>
åŸºäºCUDAçš„å¹¶è¡Œç¼–ç¨‹å­¦ä¹ ç¬”è®°<br><br> 
åˆ†äº«åˆ°ï¼š<a title="åˆ†äº«åˆ°å¾®ä¿¡" class="bshare-weixin"></a>
<a title="åˆ†äº«åˆ°æ–°æµªå¾®åš" class="bshare-sinaminiblog"></a>
<a title="åˆ†äº«åˆ°Facebook" class="bshare-facebook"></a>
<a title="åˆ†äº«åˆ°Twitter" class="bshare-twitter"></a>
<a title="åˆ†äº«åˆ°QQå¥½å‹" class="bshare-qqim" href="javascript:void(0);"></a>
<a title="åˆ†äº«åˆ°è±†ç“£" class="bshare-douban"></a>
<a title="åˆ†äº«åˆ°äººäººç½‘" class="bshare-renren"></a>
<a title="æ›´å¤šå¹³å°" class="bshare-more bshare-more-icon more-style-addthis"></a>
<span class="BSHARE_COUNT bshare-share-count">0</span>
<br><br> è¯·ä¿è¯æ‚¨çš„æµè§ˆå™¨æ”¯æŒMathJaxæ’ä»¶ï¼Œä»¥å…æ•°å­¦å…¬å¼æ— æ³•æ˜¾ç¤º</div>
<script type="text/javascript" charset="utf-8" src="http://static.bshare.cn/b/buttonLite.js#style=-1&amp;uuid=b17f1493-0201-428b-be37-0724d8ab69a2&amp;pophcol=3&amp;lang=zh"></script>
<script type="text/javascript" charset="utf-8" src="http://static.bshare.cn/b/bshareC0.js"></script>
	</div>
</div>

<!-- JiaThis Button END -->
<br>
	<div class="content">
			
		<ul id="markdown-toc">
  <li><a href="#å…±äº«å†…å­˜çš„ä¼˜ç‚¹" id="markdown-toc-å…±äº«å†…å­˜çš„ä¼˜ç‚¹">å…±äº«å†…å­˜çš„ä¼˜ç‚¹</a></li>
  <li><a href="#åˆ›å»ºå…±äº«å†…å­˜" id="markdown-toc-åˆ›å»ºå…±äº«å†…å­˜">åˆ›å»ºå…±äº«å†…å­˜</a></li>
  <li><a href="#ä¾‹ç¨‹matrix-multiplication" id="markdown-toc-ä¾‹ç¨‹matrix-multiplication">ä¾‹ç¨‹ï¼šMatrix Multiplication</a>    <ul>
      <li><a href="#ä¸ä½¿ç”¨å…±äº«å†…å­˜" id="markdown-toc-ä¸ä½¿ç”¨å…±äº«å†…å­˜">ä¸ä½¿ç”¨å…±äº«å†…å­˜</a>        <ul>
          <li><a href="#ç®—æ³•è¯´æ˜" id="markdown-toc-ç®—æ³•è¯´æ˜">ç®—æ³•è¯´æ˜</a></li>
          <li><a href="#ä»£ç æ¸…å•" id="markdown-toc-ä»£ç æ¸…å•">ä»£ç æ¸…å•</a></li>
        </ul>
      </li>
      <li><a href="#ä½¿ç”¨å…±äº«å†…å­˜" id="markdown-toc-ä½¿ç”¨å…±äº«å†…å­˜">ä½¿ç”¨å…±äº«å†…å­˜</a>        <ul>
          <li><a href="#ç®—æ³•è¯´æ˜-1" id="markdown-toc-ç®—æ³•è¯´æ˜-1">ç®—æ³•è¯´æ˜</a></li>
          <li><a href="#ä»£ç æ¸…å•-1" id="markdown-toc-ä»£ç æ¸…å•-1">ä»£ç æ¸…å•</a></li>
          <li><a href="#ä»£ç ä¸‹è½½" id="markdown-toc-ä»£ç ä¸‹è½½">ä»£ç ä¸‹è½½</a></li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<hr />
<h4 id="å…±äº«å†…å­˜çš„ä¼˜ç‚¹">å…±äº«å†…å­˜çš„ä¼˜ç‚¹</h4>

<p>ä½¿ç”¨å…±äº«å†…å­˜çš„ä¼˜ç‚¹åœ¨äºï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå…±äº«å†…å­˜æ¯”å…¨å±€å†…å­˜çš„è®¿é—®é€Ÿåº¦æ›´å¿«ã€‚ä»»ä½•å¯ä»¥ä½¿ç”¨å…±äº«å†…å­˜çš„åœ°æ–¹ï¼Œéƒ½åº”è¯¥å°†å…¨å±€å†…å­˜æ›¿æ¢ä¸ºå…±äº«å†…å­˜ã€‚</p>

<h4 id="åˆ›å»ºå…±äº«å†…å­˜">åˆ›å»ºå…±äº«å†…å­˜</h4>

<p>1ã€åˆ›å»ºä¸€ä¸ªå›ºå®šå¤§å°çš„å…±äº«æ•°ç»„</p>
<pre>
<code class="cpp">
__shared__ float s_in[34];
</code>
</pre>

<p>2ã€åŠ¨æ€ç”³è¯·æ•°ç»„</p>

<p>åŠ¨æ€ç”³è¯·æ•°ç»„ä¸éœ€è¦å¯¹æ ¸å‡½æ•°è¿›è¡Œä¿®æ”¹ï¼Œä½†æ˜¯éœ€è¦åœ¨ç”³è¯·æ•°ç»„å‰åŠ ä¸Šå…³é”®å­— extern</p>

<pre>
<code class="cpp">
extern __shared__ float s_in[];
</code>
</pre>

<h3 id="ä¾‹ç¨‹matrix-multiplication">ä¾‹ç¨‹ï¼šMatrix Multiplication</h3>
<h4 id="ä¸ä½¿ç”¨å…±äº«å†…å­˜">ä¸ä½¿ç”¨å…±äº«å†…å­˜</h4>
<h5 id="ç®—æ³•è¯´æ˜">ç®—æ³•è¯´æ˜</h5>

<p>çŸ©é˜µAä¸çŸ©é˜µBç›¸ä¹˜å¾—åˆ°çŸ©é˜µC</p>

<p><img src="/img/20180927/01.PNG" width="500" /></p>

<p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œæ¯ä¸ªçº¿ç¨‹è¯»å–çŸ©é˜µAçš„ä¸€è¡Œå’ŒçŸ©é˜µBçš„ä¸€åˆ—ï¼Œè®¡ç®—ç›¸åº”çš„ç»“æœCã€‚å› æ­¤Aä»å…¨å±€å†…å­˜ä¸­è¯»å–widthæ¬¡Bï¼ŒB ä»å…¨å±€å†…å­˜ä¸­è¯»å–Aheightæ¬¡ã€‚</p>

<h5 id="ä»£ç æ¸…å•">ä»£ç æ¸…å•</h5>

<pre>
<code class="cpp">
// Matrices are stored in row-major order: 
// M(row, col) = *(M.elements + row * M.width + col) 
typedef struct {    
      int width;    
      int height;    
      float* elements; 
    } Matrix; 

// Thread block size 
#define BLOCK_SIZE 16 

// Forward declaration of the matrix multiplication kernel 
__global__ void MatMulKernel(const Matrix, const Matrix, Matrix); 

// Matrix multiplication - Host code 
// Matrix dimensions are assumed to be multiples of BLOCK_SIZE 
void MatMul(const Matrix A, const Matrix B, Matrix C) {    
  // Load A and B to device memory    
  Matrix d_A;    
  d_A.width = A.width; 
  d_A.height = A.height;    
  size_t size = A.width * A.height * sizeof(float);    
  cudaMalloc(&amp;d_A.elements, size);    
  cudaMemcpy(d_A.elements, A.elements, size,               
  cudaMemcpyHostToDevice);    
  Matrix d_B;    
  d_B.width = B.width; 
  d_B.height = B.height;    
  size = B.width * B.height * sizeof(float);    
  cudaMalloc(&amp;d_B.elements, size);    
  cudaMemcpy(d_B.elements, B.elements, size, cudaMemcpyHostToDevice);    
  // Allocate C in device memory    
  Matrix d_C;    
  d_C.width = C.width; 
  d_C.height = C.height;    
  size = C.width * C.height * sizeof(float);    
  cudaMalloc(&amp;d_C.elements, size);    
  // Invoke kernel    
  dim3 dimBlock(BLOCK_SIZE, BLOCK_SIZE);    
  dim3 dimGrid(B.width / dimBlock.x, A.height / dimBlock.y);    
  MatMulKernel&lt;&lt;&lt;dimGrid, dimBlock&gt;&gt;&gt;(d_A, d_B, d_C);    

  // Read C from device memory    
  cudaMemcpy(C.elements, Cd.elements, size, cudaMemcpyDeviceToHost);    
  
  // Free device memory    
  cudaFree(d_A.elements);    
  cudaFree(d_B.elements);    
  cudaFree(d_C.elements); 
  } 
  
  // Matrix multiplication kernel called by MatMul()
   __global__ void MatMulKernel(Matrix A, Matrix B, Matrix C) {    
     // Each thread computes one element of C   
     // by accumulating results into Cvalue   
     float Cvalue = 0;    
     int row = blockIdx.y * blockDim.y + threadIdx.y;    
     int col = blockIdx.x * blockDim.x + threadIdx.x;    
     for (int e = 0; e &lt; A.width; ++e)        
        Cvalue += A.elements[row * A.width + e] * B.elements[e * B.width + col];    
      C.elements[row * C.width + col] = Cvalue;
   }
</code>
</pre>

<h4 id="ä½¿ç”¨å…±äº«å†…å­˜">ä½¿ç”¨å…±äº«å†…å­˜</h4>
<h5 id="ç®—æ³•è¯´æ˜-1">ç®—æ³•è¯´æ˜</h5>

<p><img src="/img/20180927/02.PNG" width="500" /></p>

<p>åœ¨ä½¿ç”¨å…±äº«å†…å­˜çš„æƒ…å†µçš„æƒ…å†µä¸‹ï¼Œæ¯ä¸ªçº¿ç¨‹å—è´Ÿè´£è®¡ç®—çŸ©é˜µCçš„å­çŸ©é˜µ$C_{sub}$ï¼Œè€Œçº¿ç¨‹å—ä¸­çš„çº¿ç¨‹è´Ÿè´£è®¡ç®—å­çŸ©é˜µ$C_{sub}$ä¸­çš„å…ƒç´ ã€‚$C_{sub}$çš„è®¡ç®—æ–¹æ³•å¦‚ä¸Šå›¾æ‰€ç¤ºã€‚$C_{sub}$å¯ä»¥çœ‹åšæ˜¯çŸ©é˜µAå’ŒBçš„ä¸¤ä¸ªçŸ©å½¢å­çŸ©é˜µç›¸ä¹˜ã€‚</p>

<p>ä¸ºäº†æ–¹ä¾¿è®¡ç®—å’Œå……åˆ†åˆ©ç”¨è®¾å¤‡èµ„æºï¼Œè¦å°†ä¸¤ä¸ªçŸ©é˜µå°½å¯èƒ½çš„åˆ’åˆ†ä¸ºç»´åº¦ä¸º block _size çš„æ–¹é˜µã€‚</p>

<p>åœ¨å…·ä½“çš„ä»£ç å®ç°ä¸­ï¼Œä¸ºäº†è®¡ç®—ï¼Œé¦–å…ˆä»å…¨å±€å†…å­˜ä¸­é‡‡ç”¨ <strong>ä¸€ä¸ªçº¿ç¨‹åŠ è½½ä¸€ä¸ªå…ƒç´ </strong> çš„æ–¹å¼ï¼Œå°†æ¯ä¸ªæ–¹é˜µåŠ è½½åˆ°å…±äº«å†…å­˜ä¸­ã€‚</p>

<p>æ•´ä¸ªè¿‡ç¨‹ä¸­ï¼ŒAä»å…¨å±€å†…å­˜ä¸­è¯»å– (B,width/block_size) æ¬¡ï¼Œè€ŒBä»å…¨å±€çŸ©é˜µä¸­è¯»å– (A.height/block_size) æ¬¡ã€‚</p>

<h5 id="ä»£ç æ¸…å•-1">ä»£ç æ¸…å•</h5>

<p>è¿™ä¸€éƒ¨åˆ†ä»£ç å®šä¹‰äº†çŸ©é˜µçš„æ•°æ®ç»“æ„ï¼Œå…¶ä¸­åŒ…æ‹¬çŸ©é˜µé•¿å’Œå®½ï¼Œä»¥åŠçŸ©é˜µçš„æ­¥é•¿ã€‚</p>

<pre>
<code class="cpp">

// Matrices are stored in row-major order: 
// M(row, col) = *(M.elements + row * M.stride + col) 
typedef struct {    
    int width;   
    int height;    
    int stride;     
    float* elements;
    } Matrix; 

</code>
</pre>

<p>å‡½æ•°GetElementï¼Œå®ç°äº†ä»çŸ©é˜µçš„æŒ‡å®šä½ç½®æå–å…ƒç´ å€¼ã€‚</p>

<pre>
<code class="cpp">
// Get a matrix element 
__device__ float GetElement(const Matrix A, int row, int col) 
{   
   return A.elements[row * A.stride + col]; 
}
</code>
</pre>

<p>å‡½æ•°SetElementï¼Œå®ç°äº†ç»™çŸ©é˜µçš„æŒ‡å®šä½ç½®èµ‹å€¼ã€‚</p>

<pre>
<code class="cpp">

// Set a matrix element 
__device__ void SetElement(Matrix A, int row, int col, float value) 
{    
  A.elements[row * A.stride + col] = value;
}

</code>
</pre>

<p>å‡½æ•°GetSubMatrixï¼Œå®ç°äº†æå–çŸ©é˜µçš„æŒ‡å®šå¤§å°çš„å­çŸ©é˜µ</p>

<pre>
<code class="cpp">

// Get the BLOCK_SIZExBLOCK_SIZE sub-matrix Asub of A that is 
// located col sub-matrices to the right and row sub-matrices down 
// from the upper-left corner of A 
__device__ Matrix GetSubMatrix(Matrix A, int row, int col) 
{    
  Matrix Asub;    Asub.width    = BLOCK_SIZE;    
  Asub.height   = BLOCK_SIZE;    
  Asub.stride   = A.stride;    
  Asub.elements = &amp;A.elements[A.stride * BLOCK_SIZE * row  + BLOCK_SIZE * col];   
   return Asub;
 } 
</code>
</pre>

<p>å®å®šä¹‰BLOCK_SIZEçš„å¤§å°</p>

<pre>
<code class="cpp">
 // Thread block size 
 #define BLOCK_SIZE 16 
</code>
</pre>

<p>å£°æ˜å‡½æ•°</p>

<pre>
<code class="cpp">
// Forward declaration of the matrix multiplication kernel 
__global__ void MatMulKernel(const Matrix, const Matrix, Matrix); 
</code>
</pre>

<p>å®ç°çŸ©é˜µç›¸ä¹˜</p>

<pre>
<code class="cpp">
// Matrix multiplication - Host code 
// Matrix dimensions are assumed to be multiples of BLOCK_SIZE 
void MatMul(const Matrix A, const Matrix B, Matrix C) 
{    
  // Load A and B to device memory    
  Matrix d_A;    
  d_A.width = d_A.stride = A.width;
  d_A.height = A.height;    
  size_t size = A.width * A.height * sizeof(float);   
  cudaMalloc(&amp;d_A.elements, size);   
  cudaMemcpy(d_A.elements, A.elements, size, cudaMemcpyHostToDevice);    
  
  Matrix d_B;    
  d_B.width = d_B.stride = B.width; 
  d_B.height = B.height;   
  size = B.width * B.height * sizeof(float);
  cudaMalloc(&amp;d_B.elements, size);    
  cudaMemcpy(d_B.elements, B.elements, size, cudaMemcpyHostToDevice);    

// Allocate C in device memory   
  Matrix d_C;    
  d_C.width = d_C.stride = C.width; 
  d_C.height = C.height;    
  size = C.width * C.height * sizeof(float);   
  cudaMalloc(&amp;d_C.elements, size);    
  
  // Invoke kernel    
  dim3 dimBlock(BLOCK_SIZE, BLOCK_SIZE);    
  dim3 dimGrid(B.width / dimBlock.x, A.height / dimBlock.y);    
  MatMulKernel&lt;&lt;&lt;dimGrid, dimBlock&gt;&gt;&gt;(d_A, d_B, d_C);    

  // Read C from device memory    
  cudaMemcpy(C.elements, d_C.elements, size, cudaMemcpyDeviceToHost);  

  // Free device memory    
  cudaFree(d_A.elements);    
  cudaFree(d_B.elements);    
  cudaFree(d_C.elements); } 
</code>
</pre>

<p>è¯¥ä¾‹ç¨‹çš„æ ¸å‡½æ•°</p>

<pre>
<code class="cpp">
// Matrix multiplication kernel called by MatMul() 
__global__ void MatMulKernel(Matrix A, Matrix B, Matrix C) 
{   
  // Block row and column    
  int blockRow = blockIdx.y;    
  int blockCol = blockIdx.x;    
  
  // Each thread block computes one sub-matrix Csub of C    
  Matrix Csub = GetSubMatrix(C, blockRow, blockCol);   

  // Each thread computes one element of Csub    
  // by accumulating results into Cvalue    
  float Cvalue = 0;    

  // Thread row and column within Csub    
  int row = threadIdx.y;    
  int col = threadIdx.x;   
   // Loop over all the sub-matrices of A and B that are    
   // required to compute Csub    
   // Multiply each pair of sub-matrices together   
    // and accumulate the results    
    for (int m = 0; m &lt; (A.width / BLOCK_SIZE); ++m) {       
       // Get sub-matrix Asub of A        
       Matrix Asub = GetSubMatrix(A, blockRow, m);      

        // Get sub-matrix Bsub of B        
        Matrix Bsub = GetSubMatrix(B, m, blockCol);       

         // Shared memory used to store Asub and Bsub respectively        
         __shared__ float As[BLOCK_SIZE][BLOCK_SIZE];        
         __shared__ float Bs[BLOCK_SIZE][BLOCK_SIZE];        

         // Load Asub and Bsub from device memory to shared memory      
         // Each thread loads one element of each sub-matrix        
        As[row][col] = GetElement(Asub, row, col);       
        Bs[row][col] = GetElement(Bsub, row, col);        
        
        // Synchronize to make sure the sub-matrices are loaded       
         // before starting the computation        
         __syncthreads();

        // Multiply Asub and Bsub together        
        for (int e = 0; e &lt; BLOCK_SIZE; ++e)            
            Cvalue += As[row][e] * Bs[e][col];        
            
            // Synchronize to make sure that the preceding        
            // computation is done before loading two new       
            // sub-matrices of A and B in the next iteration       
          __syncthreads();    
      }    
      // Write Csub to device memory    
      // Each thread writes one element    
      
      SetElement(Csub, row, col, Cvalue); 
  }
</code>
</pre>

<h5 id="ä»£ç ä¸‹è½½">ä»£ç ä¸‹è½½</h5>

<p>å®Œæ•´å·¥ç¨‹ä»£ç ä¸‹è½½ï¼š<a href="./code/Share_Memory.zip">ä¸‹è½½åœ°å€</a></p>

<p>ç¯å¢ƒé…ç½®ï¼šUbuntu CUDA 9.0</p>

<hr />


		
	</div>
	<div id="posts-out-tags"># <a href="/tag/cuda.html" rel="tag">CUDA</a>, <a href="/tag/%E5%B9%B6%E8%A1%8C%E8%AE%A1%E7%AE%97.html" rel="tag">å¹¶è¡Œè®¡ç®—</a> <a href="/tags.html" class="set-1">>></a></div> 



	<div class="shang_con">
			<p><a href="javascript:void(0)" onclick="dashangToggle()" class="dashang" title="æ‰“èµï¼Œæ”¯æŒä¸€ä¸‹">æ‰“èµ</a></p>
			<div class="shang_hide_box"></div>
			<div class="shang_box">
					<br>
				<div class="shang_tit">
					<p>æ„Ÿè°¢æ‚¨çš„æ”¯æŒï¼Œæˆ‘ä¼šç»§ç»­åŠªåŠ›çš„!</p>
				</div>
				<div class="shang_payimg">
					<img src="img/ds/alipayimg.jpg" alt="æ‰«ç æ”¯æŒ" title="æ‰«ä¸€æ‰«" />
				</div>
				<div class="shang_payselect">
					<div class="pay_item checked" data-id="alipay">
						<span class="radiobox"></span>
						<span class="pay_logo"><img src="img/ds/alipay.jpg" alt="æ”¯ä»˜å®" /></span>
					</div>
					<div class="pay_item" data-id="weipay">
						<span class="radiobox"></span>
						<span class="pay_logo"><img src="img/ds/wechat.jpg" alt="å¾®ä¿¡" /></span>
					</div>
				</div>
				<br>
				<div class="shang_info">
					<p>é•¿æŒ‰è¯†åˆ«äºŒç»´ç æˆ–æ‰“å¼€<span id="shang_pay_txt">æ”¯ä»˜å®</span>æ‰«ä¸€æ‰« å®Œæˆæ‰“èµ<br>
					æˆ– ä½¿ç”¨<a href="HTTPS://QR.ALIPAY.COM/FKX08963JL6LVJZYLYGZ13" ><æ”¯ä»˜å®é“¾æ¥></a>æ‰“èµ
				</p>

				</div>
				<br>
		
				<center><a class="shang_close" href="javascript:void(0)" onclick="dashangToggle()" title="å…³é—­">å…³é—­</a></center>
			</div>
			</div>
			
			<script type="text/javascript">
			$(function(){
				$(".pay_item").click(function(){
					$(this).addClass('checked').siblings('.pay_item').removeClass('checked');
					var dataid=$(this).attr('data-id');
					$(".shang_payimg img").attr("src","img/ds/"+dataid+"img.jpg");
					$("#shang_pay_txt").text(dataid=="alipay"?"æ”¯ä»˜å®":"å¾®ä¿¡");
				});
			});
			function dashangToggle(){
				$(".shang_hide_box").fadeToggle();
				$(".shang_box").fadeToggle();
			}
			</script>

<div style="position: relative; 
/* border: 2px solid #E9F01D;  */
padding: 10px; 
padding-bottom:20px;
width:60%;
min-width:300px;
/* background:#E9F01D; */
color:#404040;
border-radius:4px;
" >
<div class="bsPromo bsPromo2"></div>
		
		
			
			
				
					
						
					
						
					
				
			
				
					
						
							
								<h5 class="page-heading">ç›¸å…³æ–‡ç« :</h5>	
							
							
	
						<small><a href="/opencv-gpu-module-1">OpenCV GPU æ¨¡å—å­¦ä¹  ï¼ˆ1ï¼‰è¯»å–GPUè®¾å¤‡ä¿¡æ¯</a> </small> 
						<small id="posts-out-tags"># <a href="/tag/opencv.html" rel="tag">OpenCV</a>, <a href="/tag/cuda.html" rel="tag">CUDA</a>, <a href="/tag/gpu.html" rel="tag">GPU</a> </small> 
						 <small  id="posts-relat-data"> <a href="#">Oct 10, 2018</a></small>
						    
						 <small id="posts-relat-source"> <a href="#">åŸåˆ›æ–‡ç«  </a></small> 
						
						<br>
						
						
					
						
					
				
			
				
			
	
			
		
			
			
				
					
						
					
						
					
				
			
				
					
						
							
							
	
						<small><a href="/compile-opencv-with-cuda-on-ubuntu">ç¼–è¯‘GPUç‰ˆæœ¬çš„OpenCV</a> </small> 
						<small id="posts-out-tags"># <a href="/tag/opencv.html" rel="tag">OpenCV</a>, <a href="/tag/cuda.html" rel="tag">CUDA</a>, <a href="/tag/gpu.html" rel="tag">GPU</a> </small> 
						 <small  id="posts-relat-data"> <a href="#">Oct 09, 2018</a></small>
						    
						 <small id="posts-relat-source"> <a href="#">åŸåˆ›æ–‡ç«  </a></small> 
						
						<br>
						
						
					
						
					
				
			
				
			
	
			
		
			
			
				
					
						
					
						
					
				
			
				
					
						
					
						
					
				
			
				
					
						
					
						
					
				
			
	
			
		
			
			
				
					
						
					
						
					
				
			
				
					
						
					
						
					
				
			
	
			
		
			
			
				
					
						
					
						
					
				
			
	
			
		
			
			
				
					
						
							
							
	
						<small><a href="/cuda_learning_03">CUDAå¹¶è¡Œç¼–ç¨‹å­¦ä¹ ï¼ˆ3ï¼‰-- å°†CUDAå¹¶è¡Œæ¨¡å‹æ‰©å±•åˆ°äºŒç»´ç©ºé—´</a> </small> 
						<small id="posts-out-tags"># <a href="/tag/cuda.html" rel="tag">CUDA</a>, <a href="/tag/%E5%B9%B6%E8%A1%8C%E8%AE%A1%E7%AE%97.html" rel="tag">å¹¶è¡Œè®¡ç®—</a> </small> 
						 <small  id="posts-relat-data"> <a href="#">Sep 26, 2018</a></small>
						    
						 <small id="posts-relat-source"> <a href="#">åŸåˆ›æ–‡ç«  </a></small> 
						
						<br>
						
						
					
						
					
				
			
				
			
	
			
		
			
			
				
					
						
							
							
	
						<small><a href="/cuda_learning_02">CUDAå¹¶è¡Œç¼–ç¨‹å­¦ä¹ ï¼ˆ2ï¼‰-- ä½¿ç”¨CUDAè®¡ç®—ä¸€ä¸ªæ•°ç»„çš„è·ç¦»å€¼</a> </small> 
						<small id="posts-out-tags"># <a href="/tag/cuda.html" rel="tag">CUDA</a>, <a href="/tag/%E5%B9%B6%E8%A1%8C%E8%AE%A1%E7%AE%97.html" rel="tag">å¹¶è¡Œè®¡ç®—</a> </small> 
						 <small  id="posts-relat-data"> <a href="#">Sep 26, 2018</a></small>
						    
						 <small id="posts-relat-source"> <a href="#">åŸåˆ›æ–‡ç«  </a></small> 
						
						<br>
						
						
					
						
					
				
			
				
			
	
			
		
			
			
				
					
						
					
						
					
				
			
				
					
						
					
						
					
				
			
	
			
		
			
			
				
					
						
					
						
					
				
			
	
			
		
			
			
				
					
						
					
						
					
				
			
				
					
						
					
						
					
				
			
	
			
		
	
		
		<!-- </ul> -->
		

		<br>
		

		<div class="bshare-custom">
			<!-- <div class="bsPromo bsPromo2"></div> -->
åˆ†äº«åˆ°ï¼š<a title="åˆ†äº«åˆ°å¾®ä¿¡" class="bshare-weixin"></a>
<a title="åˆ†äº«åˆ°æ–°æµªå¾®åš" class="bshare-sinaminiblog"></a>
<a title="åˆ†äº«åˆ°Facebook" class="bshare-facebook"></a>
<a title="åˆ†äº«åˆ°Twitter" class="bshare-twitter"></a>
<a title="åˆ†äº«åˆ°QQå¥½å‹" class="bshare-qqim" href="javascript:void(0);"></a>
<a title="åˆ†äº«åˆ°è±†ç“£" class="bshare-douban"></a>
<a title="åˆ†äº«åˆ°äººäººç½‘" class="bshare-renren"></a>
<a title="æ›´å¤šå¹³å°" class="bshare-more bshare-more-icon more-style-addthis"></a>
<span class="BSHARE_COUNT bshare-share-count">0</span>
</div>
<script type="text/javascript" charset="utf-8" src="http://static.bshare.cn/b/buttonLite.js#style=-1&amp;uuid=b17f1493-0201-428b-be37-0724d8ab69a2&amp;pophcol=3&amp;lang=zh"></script>
<script type="text/javascript" charset="utf-8" src="http://static.bshare.cn/b/bshareC0.js"></script>
	

	</div>

</article>



	  </main>
		
		  <!-- Pagination links -->
      

	  </div>
	    
	    <!-- Footer -->
	    <footer><span>

<div class="footer" id="nav-links">

	<div class="footer-one">
	
		<div class="footer-ico"></div>
		<br>
		Suzhengpeng.COM
		<br>
			 <div class="footer-power">
		Proudly hosted by Github and powered by Jekyll <br> All designed by Suzhengpeng.COM </div>
		<br>
	
	</div>
	
	<div class="footer-two">
	
		

	    
		
			<a href="/pages/page/about" title="å…³äºåšä¸»">å…³äºåšä¸»</a>&nbsp;&nbsp;<br>
		

	    
		

	    
		
			<a href="/pages/page/contact" title="è”ç³»æ–¹å¼">è”ç³»æ–¹å¼</a>&nbsp;&nbsp;<br>
		

	    
		
			<a href="/pages/page/copyright" title="ç‰ˆæƒå£°æ˜">ç‰ˆæƒå£°æ˜</a>&nbsp;&nbsp;<br>
		

	    
		

	    
		

	    
		

	    
		

	    
		

	    
		

	    
		

	    
		

	    
		

	    
		

	    
		

	    
		

	    
		

	    
		

	    
		

	    
		

	    
		

	    
		

	    
		

	    
		

	    
		

	    
		

	    
		

	    
		

	    
		

	    
		

	    
		

	    
		<br>

	</div>
	<div class="footer-two">
					
				
				
				
				
				
				
				
				
				
				
				
				
				
			<a href="/pages/data/link" title="å¸¸ç”¨é“¾æ¥">å¸¸ç”¨é“¾æ¥</a>&nbsp;&nbsp;
		
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
		
	</div>
	<div class="footer-two-1">
	<b><small>å‹æƒ…é“¾æ¥</small></b>
					
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
			<br><a href="http://www.yushuai.me/" title="å°å¥¥ã®ä¸“å±é¢†åœ°" target="_blank">å°å¥¥ã®ä¸“å±é¢†åœ°</a>&nbsp;&nbsp;
		
				
				
			<br><a href="https://www.zning.net.cn/" title="å¼ å®ç½‘" target="_blank">å¼ å®ç½‘</a>&nbsp;&nbsp;
		
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
		
	</div>
	<div class="footer-three">
			<div class="footer-qrcode">
			<img src="http://tool.oschina.net/action/qrcode/generate?data=http://www.suzhengpeng.com/cuda_learning_04&output=image%2Fgif&error=L&type=0&margin=0&size=4">
			</div>
			<small>æ‰«ç åˆ†äº«</small><br>


	</div>


</div>
</span>



 </footer>

	    <!-- Script -->
      <script src="/js/main.js"></script>

	


	</div>
</body>
</html>
